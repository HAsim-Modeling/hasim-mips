#!/bin/sh

##############################################################
#
# Setup all tests for smips
#
# Usage: setup-all-tests-smips <srcdir> <destdir>
#
# Setup benchmark to run in <destdir>
#
##############################################################


# 1. Build Benchmark in $destdir
# 2. Create $destdir/run

if [ $# -ne 2 ]; then
   echo Usage $0 "<srcdir> <destdir>"
   echo $*
   exit 1
fi

srcdir=$1
destdir=$2

# echo "BMARK: $bmark"
# echo "SRC: $srcdir"

echo "Go to $destdir"
cd $destdir

echo "Creating simlinks"
mkdir -p program

/bin/ln -f -s ../../pm/simv .
/bin/ln -f -s ../../pm/simv.daidir

/bin/ln -f -s /mit/6.375/install/smips-tests/*.S program
/bin/ln -f -s $srcdir/Makefile program

echo "Making benchmark"
make -C program asm_tests_vmh

echo "Creating run script"
echo '#!/bin/sh'                                                                   > run
echo "# benchmark run script generated by $0"                                     >> run
echo "./simv +exe=program/smipsv1_simple.smips.vmh" >> run
echo "./simv +exe=program/smipsv1_addiu.smips.vmh"  >> run
echo "./simv +exe=program/smipsv1_bne.smips.vmh"    >> run
echo "./simv +exe=program/smipsv1_lw.smips.vmh"     >> run
echo "./simv +exe=program/smipsv1_sw.smips.vmh"     >> run
echo "./simv +exe=program/smipsv2_addiu.smips.vmh"  >> run
echo "./simv +exe=program/smipsv2_addu.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_andi.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_and.smips.vmh"    >> run
echo "./simv +exe=program/smipsv2_beq.smips.vmh"    >> run
echo "./simv +exe=program/smipsv2_bgez.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_bgtz.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_blez.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_bltz.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_bne.smips.vmh"    >> run
echo "./simv +exe=program/smipsv2_jalr.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_jal.smips.vmh"    >> run
echo "./simv +exe=program/smipsv2_jr.smips.vmh"     >> run
echo "./simv +exe=program/smipsv2_j.smips.vmh"      >> run
echo "./simv +exe=program/smipsv2_lui.smips.vmh"    >> run
echo "./simv +exe=program/smipsv2_lw.smips.vmh"     >> run
echo "./simv +exe=program/smipsv2_nor.smips.vmh"    >> run
echo "./simv +exe=program/smipsv2_ori.smips.vmh"    >> run
echo "./simv +exe=program/smipsv2_or.smips.vmh"     >> run
echo "./simv +exe=program/smipsv2_simple.smips.vmh" >> run
echo "./simv +exe=program/smipsv2_sll.smips.vmh"    >> run
echo "./simv +exe=program/smipsv2_sllv.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_slti.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_sltiu.smips.vmh"  >> run
echo "./simv +exe=program/smipsv2_slt.smips.vmh"    >> run
echo "./simv +exe=program/smipsv2_sltu.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_sra.smips.vmh"    >> run
echo "./simv +exe=program/smipsv2_srav.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_srl.smips.vmh"    >> run
echo "./simv +exe=program/smipsv2_srlv.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_subu.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_sw.smips.vmh"     >> run
echo "./simv +exe=program/smipsv2_xori.smips.vmh"   >> run
echo "./simv +exe=program/smipsv2_xor.smips.vmh"    >> run

chmod +x run

exit 0
